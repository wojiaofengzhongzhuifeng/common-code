<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<body>
<script>

  class MyPromise{
    status = 'PENDING' // FULLFILLED / REJECT
    successData = null
    failReason = null
    successFn = []
    failFn = []

    constructor(exec) {
      exec(this.resolve, this.reject)
    }

    resolve = (successData)=>{
      this.status = 'FULLFILLED'
      this.successData = successData
      // 从数组中取出第一个成功函数，执行，并且将这个函数从数组移除
      while (this.successFn.length !== 0){
        let firstSuccess = this.successFn.shift()
        firstSuccess(this.successData)
      }
    }

    reject = (failReason)=>{
      this.status = 'REJECT'
      this.failReason = failReason
      // 从数组中取出第一个失败函数，执行，并且将这个函数从数组移除
      while (this.failFn.length !== 0){
        let firstFail = this.failFn.shift()
        firstFail(this.failReason)
      }
    }

    then = (successFn, failFn)=>{
      if(this.status === 'FULLFILLED'){
        successFn(this.successData)
      } else if (this.status === 'REJECT'){
        failFn(this.failReason)
      } else {
        this.successFn.push(successFn)
        this.failFn.push(failFn)
      }
    }
  }

  let promise1 = new MyPromise((resolve, reject)=>{
    let math = Math.random()
    if(math >0.5){
      resolve(math)
    } else {
      reject(math)
    }
  })
  promise1.then((biggerPoint5Number)=>{
    console.log('biggerPoint5Number', biggerPoint5Number);
  }, (smallerPoint5Number)=>{
    console.log('smallerPoint5Number', smallerPoint5Number);
  })

  let promise2 = new MyPromise((resolve, reject)=>{
    setTimeout(()=>{
      let math = Math.random()
      if(math >0.5){
        resolve(math)
      } else {
        reject(math)
      }
    }, 1000)
  })
  promise2.then((biggerPoint5Number)=>{
    console.log('async biggerPoint5Number', biggerPoint5Number);
  }, (smallerPoint5Number)=>{
    console.log('async smallerPoint5Number', smallerPoint5Number);
  })


  let promise3 = new MyPromise((resolve, reject)=>{
    setTimeout(()=>{
      let math = Math.random()
      if(math >0.5){
        resolve(math)
      } else {
        reject(math)
      }
    }, 1000)
  })
  promise3.then((biggerPoint5Number)=>{
    console.log('promise3 resolve biggerPoint5Number', biggerPoint5Number);
  }, (smallerPoint5Number)=>{
    console.log('promise3 reject smallerPoint5Number', smallerPoint5Number);
  })
  promise3.then((biggerPoint5Number)=>{
    console.log('promise3 resolve biggerPoint5Number', biggerPoint5Number);
  }, (smallerPoint5Number)=>{
    console.log('promise3 reject smallerPoint5Number', smallerPoint5Number);
  })
</script>
</body>
</html>
